#!/usr/bin/env bash
# ghctest - GHC test help

function ghctest() {
	if [[ -e './Makefile' ]]; then
		N=12
		W=fast
		FILE="fast-log"
		if [[ -n "$1" ]]; then
			N=$1
		fi
		if [[ -n "$2" ]]; then
			W=$2
		fi
		if [[ -n "$3" ]]; then
			FILE=$2
		fi
		echo "Running testsuite ($W) with $N threads."
		echo "Saving log to file $FILE."
		echo ""
		echo "============================================================"
		make $W THREADS=$N 2>&1 | tee $FILE
		echo "============================================================"
		echo "Testing ran successfully with $N threads."
		echo "Log saved to file $FILE"
		echo ""
	else
		echo "Error: Testsuite 'Makefile' doesn't exist"
		echo "       You don't seem to be in a GHC build tree!"
	fi
}

ghctest $@

